<div class="p-1">
    <form id="form" class="layui-form">
        <!-- 提示：如果你不想用form，你可以换成div等任何一个普通元素 -->
        <div class="layui-form-item">
            <label class="layui-form-label">员工编号</label>
            <div class="layui-input-block">
                <input type="text" name="staff_code" placeholder="请输入" autocomplete="off" class="layui-input" readonly="true" lay-verify="required">
                <!-- 员工id -->
                <input type="hidden" name="id">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">员工名称</label>
            <div class="layui-input-block">
                <input type="text" name="staff_name" placeholder="请输入" autocomplete="off" class="layui-input" lay-verify="required">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">手机号码</label>
            <div class="layui-input-block">
                <input type="number" name="phone" placeholder="请输入" autocomplete="off" class="layui-input" lay-verify="phone">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">员工账号</label>
            <div class="layui-input-inline" style="width:80px;">
                <div>
                    <input type="text" name="shop_code" autocomplete="off" class="layui-input" readonly="true">
                </div>
            </div>
            <div class="layui-input-inline" style="width:80%;">
                <input type="text" name="staff_account" placeholder="请输入员工账号" autocomplete="off" class="layui-input" lay-verify="required">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">员工密码</label>
            <div class="layui-input-block">
                <input type="password" name="password" placeholder="不修改密码请留空" autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">员工角色</label>
            <div class="layui-input-block">
                <select id="roles" name="shop_auth_role_id" lay-filter="aihao" lay-verify="required">
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">是否禁用</label>
            <div class="layui-input-block">
                <input type="checkbox" lay-skin="switch" name="is_disable" lay-filter="filter">
            </div>
        </div>
        <!--     <div class="layui-form-item layui-form-text">
      <label class="layui-form-label">请填写描述</label>
      <div class="layui-input-block">
        <textarea placeholder="请输入内容" class="layui-textarea"></textarea>
      </div>
    </div> -->
        <div class="layui-form-item">
            <div class="layui-input-block">
                <button class="layui-btn" lay-submit lay-filter="formDemo">立即提交</button>
                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
            </div>
        </div>
        <!-- 更多表单结构排版请移步文档左侧【页面元素-表单】一项阅览 -->
    </form>
</div>
<script>
// 员工id
var id = getUrlParam('id');

// 店铺代码
var shopCode;

var form = layui.form;

form.render();

// 获取员工信息
function init() {
    request.get('/staff/staff/one?id=' + id, function(res) {
        if (res.code == 0) {
            for (i in res.data) {
                if (i == 'password') {
                    continue;
                }
                $('#form').find('input[name="' + i + '"]').val(res.data[i]);
                $('#form').find('select[name="' + i + '"]').val(res.data[i]);
            }

            // 判断是否禁用
            if (res.data['is_disable']) {
                // 设置选中
                $('#form').find('input[name="is_disable"]').prop('checked', true);
            }
            form.render();
        }
    });
    form.render();
}


// 获取店铺编号
request.get('/staff/staff/getShopCode', function(res) {
    if (res.code == 0) {
        // 填写员工编号
        shopCode = res.data['shop_code'];

        // 设置固定前缀
        $('input[name="shop_code"]').val(shopCode);
    }
});

// 获取店铺权限角色
request.get('/power/power_role/getAllList', function(res) {

    if (res.code == 0) {
        for (let i = 0; i < res.data.length; i++) {
            let item = res.data[i];
            $('#roles').append('<option value="' + item.id + '">' + item.title + '</option>');
        }
        init();
        // 重新渲染表单
        form.render();
    }
});

// 开关
form.on('switch(filter)', function(data) {
    // 设置禁用的值
    $('input[name="is_disable"]').val(data.elem.checked ? 1 : 0);
});

//监听提交
form.on('submit(formDemo)', function(data) {

    // 组合员工账号
    data.field['staff_account'] = data.field['shop_code'] + '' + data.field['staff_account'];

    // 添加员工
    request.post('/staff/staff/edit', data.field, function(res) {

        if (res.code == 0) {
            layer.alert('修改成功', function() {
                location.href = '/staff/staff/list';
            });
        } else {
            layer.alert(res.msg);
        }

    });

    return false;
});
</script>